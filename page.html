<!DOCTYPE html>
<html>
<body>
   <head>
      <title>Hello world</title>
   </head>
   <h2>Welcome to the ChatRoom!</h2>
    <script src = "/socket.io/socket.io.js">
    </script>
   <p id="para">Please choose room to enter:</p>
   <div id ="divide">
     <textarea id="user_name" placeholder="Enter username" rows="1" 
	     cols="15"></textarea>
     <br/>     
     <button id="butt1" onclick="sendUser()" type="button"> 
	     Check Username</button>
     <textarea hidden id="new_namespace" placeholder="Enter new namespace"
   rows="1" cols="15"> </textarea>
     <button  hidden id="butt" onclick="sendToServer()" type="button"> 
	     Submit </button>

    </div>
    <script> var globalID = "mess";
         var globalButton = "button";
         var count = 1;
    </script>

  <div hidden class="container" id="root">
    <textarea id="mess" placeholder="Type.." rows="5" cols="50"></textarea>
    <button id="button"  onclick="sendMessage()" type="button"> Send </button>
    <script>
      function sendMessage() {
         var currentdate = new Date();
         var element = document.getElementById(globalID);
         var butt = document.getElementById(globalButton);

         var datetime = ""+ (currentdate.getMonth()+1) + "/"
                + (currentdate.getDate())  + "/"
                + currentdate.getFullYear() + " "
                + (currentdate.getHours()) + ":"
                + currentdate.getMinutes();

         var thismessage = element.value;
         element.style.display='none';
         butt.style.display='none';

         var root = document.getElementById("root");
         var parent = document.createElement("div");
         parent.className = "container";

         var para = document.createElement("p");
         var node = document.createTextNode(thismessage);
         para.appendChild(node);

         var image = document.createElement("img");
         image.src = "JustinKellyProfile.jpg";

         var time = document.createElement("span");
         time.className = "time-right";
         time.innerHTML = datetime;

         parent.appendChild(image);
         parent.appendChild(para);
         parent.appendChild(time);
         root.appendChild(parent);

         var newText = document.createElement("textarea");
         newText.id = "mess" + count;
         newText.cols = 50;
         newText.rows = 5

         var newButt = document.createElement("button");
         newButt.onclick = function () { sendMessage(); };
         newButt.id = "button" + count;
         newButt.innerHTML = " Send ";
         root.appendChild(newText);
         root.appendChild(newButt);

         ++count;
         globalButton = newButt.id;
         globalID = newText.id;
      }
     </script>
   </div>
     <script>
         var socket = io();
         var username = "";
         var namespace = "";
         
         function sendUser() {
             var elem = document.getElementById("user_name");
             var name = elem.value;
	     alert(name);
             if (name.length < 6) {
                alert("please enter a name greater than 5 characters long.");
             } else {
                alert("will check");
                socket.emit('checkUserName', { check:name });
             }
          }

          function sendToServer() {
               
              var sel = document.getElementById( "selector");
              var item = sel.options[sel.selectedIndex].value;
              var element = document.getElementById("new_namespace");
              var new_name = "";

              if (item == "new room") {
                 new_name = element.value;
              } else {
                 alert("You choose " + item + ".");
                 socket.emit('chooseNamespace', { value: item });
              }
         }

        //We can also emit events from the client. To emit an event 
        //from your client, use the emit function on the socket object.
      
        //socket.emit('clientEvent', 'Sent an event from the client!');
      
        /*To handle this custom event on client we need a listener that 
        listens for the event testerEvent.*/
        
        socket.on('namespaceNotAppr', function(data) {
             alert("username already taken, please choose another");
        });
        var parent = document.createElement("select");
        parent.id = "selector";
      
        socket.on('namespaceApproved', function(data) {
           alert(data.ext);
           namespace = data.ext;
           //window.location.assign('http://localhost:3000' + data.ext);
	   document.getElementById("para").style.display = 'none';
           document.getElementById("selector").style.display = 'none';
           document.getElementById("butt").style.display = 'none';
           document.getElementById("new_namespace").style.display = 'none';
           document.getElementById("root").hidden = false;
         });
      
        var namesp;
        //this will send namespaces available to new client
        socket.on('sendNamespace', function(data) { 

             document.getElementById("user_name").style.display = 'none';
	     document.getElementById("butt1").style.display = 'none';
	     document.getElementById("new_namespace").hidden = false;
	     document.getElementById("butt").hidden = false;
	     
             namesp = data.namespaces;
             //iterate thru the namespaces and add to html dropdown list
	     for (i=0; i < namesp.length; ++i) {
                var rm1 = document.createElement("option");
                rm1.value = namesp[i];
                rm1.text = namesp[i];
                parent.appendChild(rm1);
             }
             //add option to create namespace
             var rm = document.createElement("option");
             rm.value = "new room";
             rm.text = "new room";
             parent.appendChild(rm);

             var div = document.getElementById("divide");
	     div.appendChild(document.createElement("br"));
             div.appendChild(parent);
        });

   </script>
  </body>
</html>
